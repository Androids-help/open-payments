---
id: p2p
title: Peer-to-Peer
---
import { Mermaid } from './Mermaid'

The following use case demonstrates an individual performing a peer-to-peer payment. The user would present the 
Payment Pointer of the Receiver to its own Wallet (Issuer) and instruct it to make a payment. 

<Mermaid chart={`sequenceDiagram
participant Sender
participant Issuer as Issuer<br/>(sending wallet)
participant Acquirer as Acquirer<br/>(receiving wallet)
participant Receiver
Receiver->>Sender: Provide payment identifier
Sender->>Issuer: Initate payment (payment identifier, amount)
activate Issuer
Issuer->>Acquirer: POST /receiver/invoices
activate Issuer
activate Acquirer
Acquirer->>Acquirer: createInvoice(invoice)
Acquirer-->>Issuer: 201
deactivate Acquirer
deactivate Issuer
Issuer->>Acquirer: GET invoice_url<br/>application/connection+json
activate Acquirer
Acquirer-->>Issuer: 200 paymentDetails
deactivate Acquirer
rect rgb(0, 255, 0)
    Issuer->>Acquirer: [ push payment ]
    activate Acquirer
end
Acquirer->>Acquirer: updateInvoiceBalance(amount)
deactivate Acquirer
Issuer-->>Sender: Payment Successful
deactivate Issuer
`}
/>

# Flow

Based on the diagram above the flow is as follows:
1. Sender submits payment to its own wallet
2. Issuer wallet creates invoice on receivers wallet
3. Issuer pays invoice

## 1. Sender submits payment

The sender presents its Issuer with the payment identifier (eg. Payment Pointer) of the Receiver and the amount they want to send. 
This will instruct the Issuer to make a Peer-to-Peer payment.

## 2. Issuer creates invoice 

Given the sender provided the Issuer wallet with the receiver's Payment Pointer of `$acquirer.wallet/bob`,
the Issuer would create an invoice on the Acquirer by making a POST request with a JSON payload 
to `https://acquirer.wallet/bob/invoices`:

```http
POST /bob/invoices HTTP/1.1
Host: acquirer.wallet
Accept: application/json
Content-Type: application/json

{
  "subject": "$acquirer.wallet/receiver",
  "assetCode": "USD",
  "assetScale": 2,
  "amount": 100
}
```

The Acquirer would respond with a JSON payload containing the created Invoice,
including the URL of the Invoice:

```http
HTTP/1.1 201 Created
Content-Type: application/json
Location: https://acquirer.wallet/invoices/2d24bd87-1afc-465e-a4ec-07cb4f70f7b0

{
  "name": "https://acquirer.wallet/invoices/2d24bd87-1afc-465e-a4ec-07cb4f70f7b0",
  "subject": "$acquirer.wallet/bob",
  "amount": 100,
  "assetCode": "USD",
  "assetScale": 2,
  "received": 0
}
```

## 3. Issuer Pays

### Get Payment Details

To complete the payment the Issuer would need to get payment details from the invoice. By doing a GET against
the invoice with the `Accept` header set to `application/connection+json`, the sender can get the 
payment details necessary to pay the invoice (eg. `destination_address` and `shared_secret`).

```http
GET /invoices/2d24bd87-1afc-465e-a4ec-07cb4f70f7b0 HTTP/1.1
Host: acquirer.wallet
Accept: application/connection+json
Content-Type: application/json

{
  "destination_address": "g.aquirer.42e0f0c9284ad401b7c941bc6173f4e",
  "shared_secret": "AvLaEGc+ojGHVezQF9DC4/7F5YIvrNPx/VM+4hJkCbs=",
}
```

### Pay the Invoice
Once the Issuer has received payment details for the invoice, it can send the payment
to the receiver. For example, the Issuer could STREAM money to the given `destination_address`.
